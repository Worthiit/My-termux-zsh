#!/data/data/com.termux/files/usr/bin/bash

ART_DIR="$HOME/.termux/ascii"
CURRENT_ART="$HOME/.termux/current_art.txt"

if [ ! -d "$ART_DIR" ] || [ -z "$(ls -A "$ART_DIR" 2>/dev/null)" ]; then
    clear
    echo -e "\033[1;31m[!] Arsenal is empty.\033[0m"
    echo -e "\033[1;33m[i] Drop your ASCII .txt files into $ART_DIR\033[0m"
    exit 1
fi

if ! command -v fzf &> /dev/null; then
    echo -e "\033[1;31m[!] Missing fzf module. Run: pkg install fzf\033[0m"
    exit 1
fi

clear
SELECTED=$(find "$ART_DIR" -maxdepth 1 -type f -name "*.txt" | fzf \
    --prompt="Select ASCII Art > " \
    --height=15 \
    --layout=reverse \
    --border \
    --preview "cat {}" \
    --preview-window=down:10:wrap)

if [ -n "$SELECTED" ]; then
    cp "$SELECTED" "$CURRENT_ART"
    clear
    echo -e "\033[1;32m[âœ”] ASCII Art replaced: $(basename "$SELECTED")\033[0m"
    zsh ~/motd.sh
else
    clear
    echo -e "\033[1;31m[!] Selection aborted.\033[0m"
fi
