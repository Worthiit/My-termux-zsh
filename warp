#!/data/data/com.termux/files/usr/bin/bash

if ! command -v ranger &> /dev/null; then
    echo -e "\033[1;36m[+] Setting up Visual File Manager (Ranger) it takes 1-3 mins for the first time...\033[0m"
    pkg install -y ranger >/dev/null 2>&1
fi

CHOICE_FILE="$HOME/.cache/warp_choice.txt"
mkdir -p "$HOME/.cache"

if [[ "$1" == "in" ]]; then
    rm -f "$CHOICE_FILE"
    ranger --choosefile="$CHOICE_FILE" /sdcard/
    
    if [[ -s "$CHOICE_FILE" ]]; then
        FILE=$(cat "$CHOICE_FILE")
        cp "$FILE" .
        clear
        echo -e "\033[1;32m[✔] Pulled: $(basename "$FILE")\033[0m"
    else
        clear
        echo -e "\033[1;31m[!] Warp aborted.\033[0m"
    fi
    exit 0
fi

if [[ "$1" == "out" ]]; then
    rm -f "$CHOICE_FILE"
    ranger --choosefile="$CHOICE_FILE" .
    
    if [[ -s "$CHOICE_FILE" ]]; then
        FILE=$(cat "$CHOICE_FILE")
        cp "$FILE" /sdcard/Download/
        clear
        echo -e "\033[1;32m[✔] Pushed to Downloads: $(basename "$FILE")\033[0m"
    else
        clear
        echo -e "\033[1;31m[!] Warp aborted.\033[0m"
    fi
    exit 0
fi

echo -e "\033[1;36m>>> WARP FILE BRIDGE <<<\033[0m"
echo "Usage:"
echo "  warp in  - Opens visual browser in Android storage. Find file, press Enter to pull."
echo "  warp out - Opens visual browser here. Find file, press Enter to push to Downloads."
